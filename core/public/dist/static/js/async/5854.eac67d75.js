"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["5854"],{83077:function(e,t,a){a.d(t,{Z:()=>v});var s=a(58786),l=a(70392),i=a(82994),r=a(68449),o=a(90838),u=a(14863),n=a(72632),c=a(95691),d=a(58964),p=a(65391),b=a(45334),m=a(62635);let v={__name:"index",props:{options:{type:Object,required:!0},height:{type:[String,Number],default:"100%"},theme:{type:String,default:"default"},notMerge:{type:Boolean,default:!1},lazyUpdate:{type:Boolean,default:!1}},setup(e,t){let{expose:a}=t;l.D([u.N,n.N,c.N,d.N,p.N,b.N,r.N,o.N,m.N]);let v=(0,s.iH)(null),g=(0,s.Fl)(()=>"number"==typeof e.height?`${e.height}px`:e.height),_=null,f=null,S=()=>{v.value&&(_=i.S1(v.value,e.theme,{renderer:"canvas",useDirtyRect:!0}),w(),(f=new ResizeObserver(()=>{requestAnimationFrame(()=>{null==_||_.resize()})})).observe(v.value))},w=()=>{_&&e.options&&_.setOption(e.options,{notMerge:e.notMerge,lazyUpdate:e.lazyUpdate})};return(0,s.bv)(()=>{S()}),(0,s.SK)(()=>{null==f||f.disconnect(),_&&(_.dispose(),_=null)}),(0,s.YP)(()=>e.options,()=>{w()},{deep:!0}),(0,s.YP)(()=>e.theme,()=>{_&&(_.dispose(),S())}),a({getChartInstance:()=>_,resize:()=>null==_?void 0:_.resize()}),(e,t)=>((0,s.wg)(),(0,s.iD)("div",{ref_key:"chartRef",ref:v,style:(0,s.j5)({width:"100%",height:(0,s.SU)(g)})},null,4))}}},4340:function(e,t,a){a.d(t,{Z:()=>u});var s=a(15496),l=a(23685),i=a(58786);let r={class:"flex gap-10px"},o={class:"flex-center w-40px"},u=(0,i.aZ)({__name:"index",props:{data:{type:Array,default:()=>[]},rowKey:{type:Function,required:!0},options:{type:Array,default:()=>[]},checkedRowKeys:{type:Array,default:()=>[]}},emits:["updateCheckedRowKeys","select"],setup(e,t){let{emit:a}=t,u=(0,i.Fl)({get:()=>e.checkedRowKeys.length>0&&e.checkedRowKeys.length===e.data.length,set(t){a("updateCheckedRowKeys",t?e.data.map(t=>e.rowKey(t)):[])}}),n=(0,i.Fl)(()=>0===e.data.length),c=(0,i.Fl)(()=>e.checkedRowKeys.length>0&&e.checkedRowKeys.length<e.data.length),d=(0,i.Fl)(()=>0===e.checkedRowKeys.length),p=t=>{a("select",t,e.checkedRowKeys)};return(t,a)=>{let b=l.Z,m=s.ZP;return(0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",o,[(0,i.Wm)(b,{checked:(0,i.SU)(u),"onUpdate:checked":a[0]||(a[0]=e=>(0,i.dq)(u)?u.value=e:null),disabled:(0,i.SU)(n),indeterminate:(0,i.SU)(c)},null,8,["checked","disabled","indeterminate"])]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.options,e=>((0,i.wg)(),(0,i.j4)(m,{key:e.value,disabled:(0,i.SU)(d)||e.disabled,onClick:t=>p(e.value)},{default:(0,i.w5)(()=>[(0,i.Uk)((0,i.zw)(e.label),1)]),_:2},1032,["disabled","onClick"]))),128))])}}})},41161:function(e,t,a){a.r(t),a.d(t,{default:()=>eS});var s=a(39244),l=a(25170),i=a(60424),r=a(66760),o=a(86559),u=a(4340),n=a(8490),c=a(58786),d=a(94821),p=a(53903),b=a(93953),m=a(15496),v=a(68271),g=a(51169),_=a(80947),f=a(34541);let{t:S}=a(76882).ag.global,w=e=>f.e.get("/contact/list_ndp",{params:e}),U=e=>f.e.get("/contact/trend",{params:e}),y=e=>f.e.post("/contact/group/import",e,{fetchOptions:{loading:S("contacts.subscribers.loading.importSubscribers"),successMessage:!0}}),h=e=>f.e.post("/contact/edit_ndp",e,{fetchOptions:{loading:S("contacts.subscribers.loading.updateSubscriberGroup"),successMessage:!0}}),x=e=>f.e.post("/contact/delete_ndp",e,{fetchOptions:{loading:S("contacts.subscribers.loading.deleteSubscriber"),successMessage:!0}}),W=e=>f.e.post("/contact/batch_tags_opt",e,{fetchOptions:{loading:S("contacts.subscribers.loading.batchSetTag"),successMessage:!0}});var Z=a(84075),k=a(52495);let z=(0,c.aZ)({__name:"GroupSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let{t}=(0,k.QT)(),a=(0,c.tT)(e,"value"),s=(0,c.iH)([{label:t("common.all.text"),value:0}]);return(async()=>{let e=await (0,Z.WH)();(0,v.Kn)(e)&&(s.value=e.list.map(e=>({label:e.name,value:e.id})),s.value.unshift({label:t("common.all.text"),value:0}))})(),(e,t)=>{let l=n.Z;return(0,c.wg)(),(0,c.j4)(l,{value:a.value,"onUpdate:value":t[0]||(t[0]=e=>a.value=e),options:(0,c.SU)(s)},null,8,["value","options"])}}});var T=a(43458),O=a(65965);let R=(0,c.aZ)({__name:"TagSelect",props:(0,c.Vf)({groupId:{type:Number,default:0}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){let{t}=(0,k.QT)(),a=(0,c.tT)(e,"value"),s=(0,c.iH)([]),l=(0,c.Fl)(()=>s.value.filter(t=>0===e.groupId||e.groupId===t.group_id).map(e=>({label:e.name,value:e.id})));(async()=>{let e=await (0,T.CZ)({});(0,v.Kn)(e)&&(s.value=e.list)})();let i=(0,O.tv)(),r=()=>{i.push({path:"/contacts/tags",state:{group_id:e.groupId}})};return(e,s)=>{let i=m.ZP,o=n.Z;return(0,c.wg)(),(0,c.j4)(o,{value:a.value,"onUpdate:value":s[0]||(s[0]=e=>a.value=e),options:(0,c.SU)(l),multiple:!0,"max-tag-count":"responsive"},{action:(0,c.w5)(()=>[(0,c.Wm)(i,{block:"",onClick:r},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("contacts.subscribers.tagSelect.manageTags")),1)]),_:1})]),_:1},8,["value","options"])}}}),C={class:"w-80px"},F={class:"w-120px"},P=(0,c.aZ)({__name:"ActiveSelect",props:{value:{default:-1},valueModifiers:{},time:{},timeModifiers:{}},emits:["update:value","update:time"],setup(e){let{t}=(0,k.QT)(),a=(0,c.tT)(e,"value"),s=(0,c.Fl)(()=>[{label:t("contacts.subscribers.activeSelect.options.all"),value:-1},{label:t("contacts.subscribers.activeSelect.options.yes"),value:1},{label:t("contacts.subscribers.activeSelect.options.no"),value:0}]),l=(0,c.tT)(e,"time"),i=(0,c.Fl)(()=>[{label:t("contacts.subscribers.activeSelect.timeOptions.past7Days"),value:7},{label:t("contacts.subscribers.activeSelect.timeOptions.pastMonth"),value:30},{label:t("contacts.subscribers.activeSelect.timeOptions.past90Days"),value:90},{label:t("contacts.subscribers.activeSelect.timeOptions.pastHalfYear"),value:180},{label:t("contacts.subscribers.activeSelect.timeOptions.pastYear"),value:365}]),r=e=>{-1===e?l.value=0:l.value=365};return(e,t)=>{let o=n.Z;return(0,c.wg)(),(0,c.iD)(c.HY,null,[(0,c._)("div",C,[(0,c.Wm)(o,{value:a.value,"onUpdate:value":[t[0]||(t[0]=e=>a.value=e),r],options:(0,c.SU)(s)},null,8,["value","options"])]),(0,c.wy)((0,c._)("div",F,[(0,c.Wm)(o,{value:l.value,"onUpdate:value":t[1]||(t[1]=e=>l.value=e),options:(0,c.SU)(i)},null,8,["value","options"])],512),[[c.F8,-1!==a.value]])],64)}}});var $=a(60579),j=a(83077);let D={class:"text-center fw-bold text-16px text-default"},H={class:"w-96% h-160px mx-auto"},K=(0,c.aZ)({__name:"SubscriberTrends",props:{params:{type:Object,default:()=>({page:1,page_size:10,group_id:0,keyword:"",active:-1,last_active_status:-1,time_interval:0,tags:[]})}},setup(e,t){let{expose:a}=t,s=(0,c.iH)(!1),l=(0,c.iH)([]),{t:i}=(0,k.QT)(),r=(0,c.Fl)(()=>({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},grid:{top:"16%",left:"2%",right:"2%",bottom:"4%",containLabel:!0},xAxis:{data:l.value.map(e=>e.date),axisTick:{show:!1},axisLabel:{color:"#6b7280",fontSize:12}},yAxis:{type:"value",minInterval:1,axisLabel:{color:"#6b7280",fontSize:12}},series:[{name:i("contacts.subscribers.trends.subscriber"),type:"line",data:l.value.map(e=>e.count),itemStyle:{color:"#20a53a"},smooth:!0,showSymbol:!1,sampling:"average",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,global:!1,colorStops:[{offset:0,color:"rgba(32, 164, 58, 0.4)"},{offset:.7,color:"rgba(32, 164, 58, 0)"}]}}}]})),o=async()=>{try{s.value=!0;let t=await U({group_id:e.params.group_id,active:e.params.active,last_active_status:e.params.last_active_status,time_interval:e.params.time_interval,tags:e.params.tags.join(",")});(0,v.Kn)(t)&&("monthly"===t.time_granularity?l.value=(0,v.kJ)(t.monthly_data)?t.monthly_data:[]:"daily"===t.time_granularity&&(l.value=(0,v.kJ)(t.daily_data)?t.daily_data:[]))}finally{s.value=!1}};return(0,c.bv)(()=>{o()}),a({getData:o}),(e,t)=>{let a=j.Z,l=$.Z;return(0,c.wg)(),(0,c.j4)(l,{class:"mb-16px",show:(0,c.SU)(s)},{default:(0,c.w5)(()=>[(0,c._)("div",D,(0,c.zw)((0,c.SU)(i)("contacts.subscribers.trends.title")),1),(0,c._)("div",H,[(0,c.Wm)(a,{options:(0,c.SU)(r)},null,8,["options"])])]),_:1},8,["show"])}}});var N=a(46244),q=a(73084),A=a(3179),M=a(16715),I=a(77227),G=a(81833),E=a(37864),L=a(6455),Q=a(46471),Y=a(98003);let X=(0,c.aZ)({__name:"GroupMultipleSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let t=(0,c.tT)(e,"value"),a=(0,c.iH)([]),s=(0,c.iH)(!1);return(async()=>{try{s.value=!0;let e=await (0,Z.WH)();(0,v.Kn)(e)&&(a.value=e.list.map(e=>({label:e.name,value:e.id})))}finally{s.value=!1}})(),(e,l)=>{let i=n.Z;return(0,c.wg)(),(0,c.j4)(i,{value:t.value,"onUpdate:value":l[0]||(l[0]=e=>t.value=e),"max-tag-count":"responsive",multiple:!0,filterable:!0,loading:(0,c.SU)(s),options:(0,c.SU)(a)},null,8,["value","loading","options"])}}}),J={class:"pt-12px"},B={class:"flex-1"},V={class:"mb-8px text-desc"},ee={class:"w-260px"},et={class:"flex-1"},ea={class:"mt-8px"},es={class:"mt-8px text-12px text-desc"},el={class:"mt-8px text-12px text-desc"},ei=`email,attributes
example1@example.com,"{""age"": ""13"", ""Gender"": ""XXX""}"
example2@example.com,"{""age"": ""45"", ""city"": ""XXX""}"
`,er=(0,c.aZ)({__name:"SubscriberImport",setup(e){let{t}=(0,k.QT)(),a=(0,c.AE)("formRef"),s=(0,c.iH)("paste"),l=(0,c.qj)({group_ids:[],import_type:1,contacts:"",file_data:"",file_type:"",overwrite:0,default_active:1,status:1}),i={group_ids:{trigger:"change",validator:()=>0!==l.group_ids.length||Error(t("contacts.subscribers.import.validation.groupRequired"))},contacts:{validator:()=>!(2===l.import_type&&(0,Q.Z)(l.contacts))||Error(t("contacts.subscribers.import.validation.dataRequired"))}},r=(0,c.Fl)(()=>[{label:t("contacts.subscribers.import.overwriteOptions.no"),value:0},{label:t("contacts.subscribers.import.overwriteOptions.yes"),value:1}]),o=(0,c.Fl)(()=>[{label:t("contacts.subscribers.import.subscriptionOptions.subscribe"),value:1},{label:t("contacts.subscribers.import.subscriptionOptions.unsubscribe"),value:0}]),u=(0,c.Fl)(()=>[{label:t("contacts.subscribers.import.statusOptions.confirmed"),value:1},{label:t("contacts.subscribers.import.statusOptions.unconfirmed"),value:0}]),d=e=>{let t=new FileReader;t.onload=t=>{var a;l.file_type=e.name.substring(e.name.lastIndexOf(".")+1),l.file_data=null==(a=t.target)?void 0:a.result},e.file&&t.readAsText(e.file)},p=async()=>{await (0,Y.Sv)({file_path:"./template/example_recipients.csv"})},b=async()=>{var e;if(await (null==(e=a.value)?void 0:e.validate()),"upload"===s.value&&(0,Q.Z)(l.file_data))return v.v0.error(t("contacts.subscribers.import.validation.fileRequired")),Promise.reject()},[_,f]=(0,g.d)({onChangeState:e=>{if(e){let e=f.getState();(null==e?void 0:e.group_id)?l.group_ids=[e.group_id]:l.group_ids=[]}else l.import_type=1,l.contacts="",l.file_data="",l.file_type="",l.group_ids=[],l.overwrite=0,l.default_active=1,l.status=1},onConfirm:async()=>{await b(),await y((0,c.IU)(l));let e=f.getState();null==e||e.refresh()}});return(e,t)=>{let s=n.Z,b=L.ZP,v=E.ZP,g=G.Z,f=I.Z,S=M.Z,w=A.Z,U=m.ZP,y=q.Z,h=N.Z;return(0,c.wg)(),(0,c.j4)((0,c.SU)(_),{title:e.$t("contacts.subscribers.import.title"),width:"640"},{default:(0,c.w5)(()=>[(0,c._)("div",J,[(0,c.Wm)(h,{ref_key:"formRef",ref:a,model:(0,c.SU)(l),rules:i},{default:(0,c.w5)(()=>[(0,c.Wm)(b,{label:e.$t("contacts.subscribers.import.overwriteLabel")},{default:(0,c.w5)(()=>[(0,c._)("div",B,[(0,c._)("div",V,(0,c.zw)(e.$t("contacts.subscribers.import.overwriteDescription")),1),(0,c._)("div",ee,[(0,c.Wm)(s,{value:(0,c.SU)(l).overwrite,"onUpdate:value":t[0]||(t[0]=e=>(0,c.SU)(l).overwrite=e),options:(0,c.SU)(r)},null,8,["value","options"])])])]),_:1},8,["label"]),(0,c.Wm)(g,{cols:2,"x-gap":24},{default:(0,c.w5)(()=>[(0,c.Wm)(v,{span:1,label:e.$t("contacts.subscribers.import.subscriptionStatus")},{default:(0,c.w5)(()=>[(0,c.Wm)(s,{value:(0,c.SU)(l).default_active,"onUpdate:value":t[1]||(t[1]=e=>(0,c.SU)(l).default_active=e),options:(0,c.SU)(o)},null,8,["value","options"])]),_:1},8,["label"]),(0,c.Wm)(v,{span:1,label:e.$t("contacts.subscribers.import.status")},{default:(0,c.w5)(()=>[(0,c.Wm)(s,{value:(0,c.SU)(l).status,"onUpdate:value":t[2]||(t[2]=e=>(0,c.SU)(l).status=e),options:(0,c.SU)(u)},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),(0,c.Wm)(b,{label:e.$t("contacts.subscribers.import.group"),path:"group_id"},{default:(0,c.w5)(()=>[(0,c.Wm)(X,{value:(0,c.SU)(l).group_ids,"onUpdate:value":t[3]||(t[3]=e=>(0,c.SU)(l).group_ids=e)},null,8,["value"])]),_:1},8,["label"]),(0,c.Wm)(b,{label:e.$t("contacts.subscribers.import.data"),path:"contacts"},{default:(0,c.w5)(()=>[(0,c._)("div",et,[(0,c.Wm)(S,{value:(0,c.SU)(l).import_type,"onUpdate:value":t[4]||(t[4]=e=>(0,c.SU)(l).import_type=e)},{default:(0,c.w5)(()=>[(0,c.Wm)(f,{value:1},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.uploadFile")),1)]),_:1}),(0,c.Wm)(f,{value:2},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.pasteData")),1)]),_:1})]),_:1},8,["value"]),(0,c._)("div",ea,[1===(0,c.SU)(l).import_type?((0,c.wg)(),(0,c.iD)(c.HY,{key:0},[(0,c.Wm)(w,{"is-upload":!1,accept:["csv"],onChange:d}),(0,c._)("div",es,[(0,c.Uk)((0,c.zw)(e.$t("contacts.subscribers.import.fileTypeHint"))+" ",1),(0,c.Wm)(U,{text:"",type:"primary",onClick:p},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("common.actions.download")),1)]),_:1})])],64)):(0,c.kq)("",!0),2===(0,c.SU)(l).import_type?((0,c.wg)(),(0,c.iD)(c.HY,{key:1},[(0,c.Wm)(y,{value:(0,c.SU)(l).contacts,"onUpdate:value":t[5]||(t[5]=e=>(0,c.SU)(l).contacts=e),type:"textarea",rows:8},null,8,["value"]),(0,c._)("div",el,[(0,c._)("p",null,(0,c.zw)(e.$t("contacts.subscribers.import.pastePlaceholder.0")),1)])],64)):(0,c.kq)("",!0)])])]),_:1},8,["label"]),(0,c.Wm)(b,{label:e.$t("contacts.subscribers.import.exampleCsvLabel")},{default:(0,c.w5)(()=>[(0,c._)("pre",{class:"csv-example"},(0,c.zw)(ei))]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}});var eo=a(41748);let eu=(0,eo.default)(er,[["__scopeId","data-v-517af80a"]]),en={class:"pt-12px"},ec=(0,c.aZ)({__name:"SubscriberEdit",setup(e){let{t}=(0,k.QT)(),a=(0,c.AE)("formRef"),s=(0,c.qj)({id:0,email:"",active:1,status:1,attribs:"",group_ids:[]}),l={group_ids:{trigger:"change",validator:()=>0!==s.group_ids.length||Error(t("contacts.subscribers.edit.validation.groupRequired"))}},i=(0,c.Fl)(()=>[{label:t("contacts.subscribers.edit.statusOptions.subscribe"),value:1},{label:t("contacts.subscribers.edit.statusOptions.unsubscribe"),value:0}]),r=(0,c.Fl)(()=>[{label:t("contacts.subscribers.import.statusOptions.confirmed"),value:1},{label:t("contacts.subscribers.import.statusOptions.unconfirmed"),value:0}]),[o,u]=(0,g.d)({onChangeState:e=>{if(e){let{row:e}=u.getState();e&&(s.id=e.id,s.email=e.email,s.active=e.active,s.status=e.status,s.group_ids=[e.group_id],s.attribs=e.attribs?JSON.stringify(e.attribs,null,2):"")}else s.id=0,s.email="",s.active=1,s.status=1,s.group_ids=[],s.attribs=""},onConfirm:async()=>{var e;await (null==(e=a.value)?void 0:e.validate());let t={};try{t=s.attribs?JSON.parse(s.attribs):{}}catch(e){return v.v0.error(`${e}`,{close:!0}),!1}await h({id:s.id,active:s.active,status:s.status,attribs:JSON.stringify(t)}),u.getState().refresh()}});return(e,t)=>{let u=q.Z,d=E.ZP,p=n.Z,b=G.Z,m=L.ZP,v=N.Z;return(0,c.wg)(),(0,c.j4)((0,c.SU)(o),{title:e.$t("contacts.subscribers.edit.title"),width:"600"},{default:(0,c.w5)(()=>[(0,c._)("div",en,[(0,c.Wm)(v,{ref_key:"formRef",ref:a,model:(0,c.SU)(s),rules:l},{default:(0,c.w5)(()=>[(0,c.Wm)(b,{cols:12,"x-gap":24},{default:(0,c.w5)(()=>[(0,c.Wm)(d,{span:8,label:e.$t("contacts.subscribers.edit.email")},{default:(0,c.w5)(()=>[(0,c.Wm)(u,{value:(0,c.SU)(s).email,"onUpdate:value":t[0]||(t[0]=e=>(0,c.SU)(s).email=e),disabled:!0},null,8,["value"])]),_:1},8,["label"]),(0,c.Wm)(d,{span:4,label:e.$t("contacts.subscribers.import.subscriptionStatus")},{default:(0,c.w5)(()=>[(0,c.Wm)(p,{value:(0,c.SU)(s).active,"onUpdate:value":t[1]||(t[1]=e=>(0,c.SU)(s).active=e),options:(0,c.SU)(i)},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),(0,c.Wm)(b,{cols:12,"x-gap":24},{default:(0,c.w5)(()=>[(0,c.Wm)(d,{span:8,label:e.$t("contacts.subscribers.edit.group"),path:"group_ids"},{default:(0,c.w5)(()=>[(0,c.Wm)(X,{value:(0,c.SU)(s).group_ids,"onUpdate:value":t[2]||(t[2]=e=>(0,c.SU)(s).group_ids=e),disabled:!0},null,8,["value"])]),_:1},8,["label"]),(0,c.Wm)(d,{span:4,label:e.$t("contacts.subscribers.import.status")},{default:(0,c.w5)(()=>[(0,c.Wm)(p,{value:(0,c.SU)(s).status,"onUpdate:value":t[3]||(t[3]=e=>(0,c.SU)(s).status=e),options:(0,c.SU)(r)},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),(0,c.Wm)(m,{label:e.$t("contacts.subscribers.edit.attributes")},{default:(0,c.w5)(()=>[(0,c.Wm)(u,{value:(0,c.SU)(s).attribs,"onUpdate:value":t[4]||(t[4]=e=>(0,c.SU)(s).attribs=e),type:"textarea",rows:6},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}});var ed=a(12112);let ep={class:"flex-1 mr-12px"},eb=(0,c.aZ)({__name:"BatchSetTag",setup(e){let{t}=(0,k.QT)(),a=(0,c.qj)({tag_ids:[],action:1}),s=(0,c.iH)([]),l=(0,c.Fl)(()=>[{label:t("contacts.subscribers.batchSetTag.actions.add"),value:1},{label:t("contacts.subscribers.batchSetTag.actions.remove"),value:2}]),i=(0,c.iH)(!1),r=async()=>{try{i.value=!0;let e=await (0,T.CZ)({});if((0,v.Kn)(e)){let{groupId:t}=_.getState();s.value=e.list.filter(e=>e.group_id===t).map(e=>({label:e.name,value:e.id}))}}finally{i.value=!1}},[o,u]=(0,g.d)({component:ed.Z,state:{refresh:r}}),d=()=>{let{groupId:e}=_.getState();u.setState({row:null,isEdit:!1,groupId:e}),u.open()},p=()=>{a.tag_ids=[],a.action=1,s.value=[]},[b,_]=(0,g.d)({onChangeState:e=>{e?r():p()},onConfirm:async()=>{let{ids:e,refresh:t}=_.getState();await W({ids:e,tag_ids:a.tag_ids,action:a.action}),t()}});return(e,r)=>{let u=n.Z,p=m.ZP,v=L.ZP,g=N.Z;return(0,c.wg)(),(0,c.j4)((0,c.SU)(b),{title:(0,c.SU)(t)("contacts.subscribers.batchSetTag.title"),width:500},{default:(0,c.w5)(()=>[(0,c.Wm)(g,{class:"pt-8px"},{default:(0,c.w5)(()=>[(0,c.Wm)(v,{label:(0,c.SU)(t)("contacts.subscribers.batchSetTag.labels.tag")},{default:(0,c.w5)(()=>[(0,c._)("div",ep,[(0,c.Wm)(u,{value:(0,c.SU)(a).tag_ids,"onUpdate:value":r[0]||(r[0]=e=>(0,c.SU)(a).tag_ids=e),options:(0,c.SU)(s),multiple:!0,loading:(0,c.SU)(i),"max-tag-count":"responsive"},null,8,["value","options","loading"])]),(0,c.Wm)(p,{type:"primary",text:"",onClick:d},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)(e.$t("common.actions.create")),1)]),_:1})]),_:1},8,["label"]),(0,c.Wm)(v,{label:(0,c.SU)(t)("contacts.subscribers.batchSetTag.labels.action")},{default:(0,c.w5)(()=>[(0,c.Wm)(u,{value:(0,c.SU)(a).action,"onUpdate:value":r[1]||(r[1]=e=>(0,c.SU)(a).action=e),options:(0,c.SU)(l)},null,8,["value","options"])]),_:1},8,["label"]),(0,c.Wm)((0,c.SU)(o))]),_:1})]),_:1},8,["title"])}}}),em={class:"w-140px"},ev={class:"w-140px"},eg={class:"w-200px"};function e_(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!(0,c.lA)(e)}let ef=(0,c.aZ)({__name:"index",setup(e){let{t}=(0,k.QT)(),a=(0,d.tLD)(),f=(0,O.tv)(),S=(0,c.AE)("trendRef"),U=(0,c.Fl)(()=>[{label:t("common.all.text"),value:-1},{label:t("contacts.subscribers.status.subscribed"),value:1},{label:t("contacts.subscribers.status.unsubscribed"),value:0}]),{tableParams:y,tableProps:h,batchProps:W,pageProps:Z,fetchTable:T,resetTable:C}=(0,_.N)({params:{page:1,page_size:10,group_id:a.value.state.group_id||0,keyword:"",active:-1,last_active_status:-1,time_interval:0,tags:a.value.state.tag_id?[a.value.state.tag_id]:[]},useParams:e=>({...e,tags:e.tags.join(",")}),fetchFn:w}),F=(0,c.Fl)(()=>[{type:"selection",width:40},{key:"email",title:t("contacts.subscribers.columns.email"),minWidth:120,ellipsis:{tooltip:!0}},{key:"status",title:t("contacts.subscribers.labels.status").replace("：",""),minWidth:100,render:e=>{let a;if(0===e.active){let e;return(0,c.Wm)(p.ZP,{size:"small",type:"error",bordered:!1},e_(e=t("contacts.subscribers.status.unsubscribed"))?e:{default:()=>[e]})}if(1===e.active&&0===e.status){let e;return(0,c.Wm)(p.ZP,{size:"small",type:"default",bordered:!1},e_(e=t("contacts.subscribers.status.unconfirmed"))?e:{default:()=>[e]})}return(0,c.Wm)(p.ZP,{size:"small",type:"success",bordered:!1},e_(a=t("contacts.subscribers.status.subscribed"))?a:{default:()=>[a]})}},{key:"last_active_at",title:t("contacts.subscribers.columns.lastActiveAt"),minWidth:100,render:e=>e.last_active_at?(0,d.INm)(new Date(1e3*e.last_active_at)).value:"--"},{key:"groups",title:t("contacts.subscribers.joinGroup"),minWidth:100,render:e=>e.group_name||""},{key:"tags",title:t("contacts.subscribers.tags"),minWidth:100,render:e=>{let t;return e.tags&&0!==e.tags.length?(0,c.Wm)(b.Z,{inline:!0},e_(t=e.tags.map(e=>(0,c.Wm)(p.ZP,{key:e.id,size:"small",bordered:!1},{default:()=>[e.name]})))?t:{default:()=>[t]}):"--"}},{title:t("common.columns.actions"),key:"actions",align:"right",width:180,render:e=>{let a,s;return(0,c.Wm)(b.Z,{inline:!0},{default:()=>[(0,c.Wm)(m.ZP,{type:"primary",text:!0,onClick:()=>{I(e)}},e_(a=t("common.actions.edit"))?a:{default:()=>[a]}),(0,c.Wm)(m.ZP,{type:"error",text:!0,onClick:()=>{G(e)}},e_(s=t("common.actions.delete"))?s:{default:()=>[s]})]})}}]),$=()=>{var e;C(),null==(e=S.value)||e.getData()},j=()=>{y.value.tags=[],$()},[D,H]=(0,g.d)({component:eu,state:{refresh:T}}),N=()=>{H.setState({group_id:y.value.group_id}),H.open()},q=()=>{if(!y.value.group_id)return void v.v0.warning(t("contacts.subscribers.selectGroupHint"));f.push(`/contacts/settings/${y.value.group_id}`)},[A,M]=(0,g.d)({component:ec,state:{refresh:T}}),I=e=>{M.setState({row:e}),M.open()},G=e=>{(0,v.iG)({title:t("contacts.subscribers.delete.title"),content:t("contacts.subscribers.delete.confirm",{email:e.email}),confirmText:t("common.actions.delete"),confirmType:"error",onConfirm:async()=>{await x({ids:[e.id]}),T()}})},E=(0,c.Fl)(()=>[{label:t("common.actions.delete"),value:"delete"},{label:t("contacts.subscribers.actions.setTag"),value:"tag",disabled:0===y.value.group_id}]),L=(e,t)=>{switch(e){case"delete":Q(t);break;case"tag":J(t)}},Q=e=>{(0,v.iG)({title:t("contacts.subscribers.batchDelete.title"),content:t("contacts.subscribers.batchDelete.confirm"),confirmText:t("common.actions.delete"),confirmType:"error",onConfirm:async()=>{await x({ids:e}),T()}})},[Y,X]=(0,g.d)({component:eb,state:{refresh:T}}),J=e=>{X.setState({ids:e,groupId:y.value.group_id}),X.open()};return(e,a)=>{let d=n.Z,p=u.Z,b=o.Z,v=r.Z,g=i.Z,_=l.Z,f=s.Z;return(0,c.wg)(),(0,c.iD)("div",null,[(0,c.Wm)(K,{ref_key:"trendRef",ref:S,params:(0,c.SU)(y)},null,8,["params"]),(0,c.Wm)(f,null,{toolsLeft:(0,c.w5)(()=>[(0,c._)("span",null,(0,c.zw)(e.$t("contacts.subscribers.select.prefix")),1),(0,c._)("div",em,[(0,c.Wm)(z,{value:(0,c.SU)(y).group_id,"onUpdate:value":[a[0]||(a[0]=e=>(0,c.SU)(y).group_id=e),j]},null,8,["value"])]),(0,c._)("span",null,(0,c.zw)((0,c.SU)(t)("contacts.subscribers.labels.status")),1),(0,c._)("div",ev,[(0,c.Wm)(d,{value:(0,c.SU)(y).active,"onUpdate:value":[a[1]||(a[1]=e=>(0,c.SU)(y).active=e),a[2]||(a[2]=()=>$())],options:(0,c.SU)(U)},null,8,["value","options"])]),(0,c._)("span",null,(0,c.zw)((0,c.SU)(t)("contacts.subscribers.labels.tags")),1),(0,c._)("div",eg,[(0,c.Wm)(R,{value:(0,c.SU)(y).tags,"onUpdate:value":[a[3]||(a[3]=e=>(0,c.SU)(y).tags=e),a[4]||(a[4]=()=>$())],disabled:0===(0,c.SU)(y).group_id,"group-id":(0,c.SU)(y).group_id},null,8,["value","disabled","group-id"])]),(0,c._)("span",null,(0,c.zw)((0,c.SU)(t)("contacts.subscribers.labels.active")),1),(0,c.Wm)(P,{value:(0,c.SU)(y).last_active_status,"onUpdate:value":[a[5]||(a[5]=e=>(0,c.SU)(y).last_active_status=e),a[7]||(a[7]=()=>$())],time:(0,c.SU)(y).time_interval,"onUpdate:time":[a[6]||(a[6]=e=>(0,c.SU)(y).time_interval=e),a[8]||(a[8]=()=>$())]},null,8,["value","time"])]),pageLeft:(0,c.w5)(()=>[(0,c.Wm)(p,(0,c.dG)((0,c.SU)(W),{options:(0,c.SU)(E),onSelect:L}),null,16,["options"])]),toolsRight:(0,c.w5)(()=>[(0,c.Wm)(b,{value:(0,c.SU)(y).keyword,"onUpdate:value":a[9]||(a[9]=e=>(0,c.SU)(y).keyword=e),width:240,placeholder:(0,c.SU)(t)("contacts.subscribers.search.emailPlaceholder"),onSearch:(0,c.SU)(C)},null,8,["value","placeholder","onSearch"]),(0,c.Wm)((0,c.SU)(m.ZP),{type:"primary",onClick:N},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("common.actions.import")),1)]),_:1}),(0,c.SU)(y).group_id?((0,c.wg)(),(0,c.j4)((0,c.SU)(m.ZP),{key:0,onClick:q},{default:(0,c.w5)(()=>[(0,c.Uk)((0,c.zw)((0,c.SU)(t)("common.actions.settings")),1)]),_:1})):(0,c.kq)("",!0)]),table:(0,c.w5)(()=>[(0,c.Wm)(g,(0,c.dG)((0,c.SU)(h),{columns:(0,c.SU)(F)}),{empty:(0,c.w5)(()=>[(0,c.Wm)(v)]),_:1},16,["columns"])]),pageRight:(0,c.w5)(()=>[(0,c.Wm)(_,(0,c.dG)((0,c.SU)(Z),{onRefresh:(0,c.SU)(T)}),null,16,["onRefresh"])]),modal:(0,c.w5)(()=>[(0,c.Wm)((0,c.SU)(D)),(0,c.Wm)((0,c.SU)(A)),(0,c.Wm)((0,c.SU)(Y))]),_:1})])}}}),eS=(0,eo.default)(ef,[["__scopeId","data-v-a539d184"]])}}]);